<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAGU MISA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
        }
        
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            text-transform: uppercase;
        }
        
        .navbar {
            background-color: var(--secondary-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .navbar-brand {
            font-weight: 700;
            color: white !important;
        }
        
        .hero-section {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 60px 0;
            margin-bottom: 30px;
            border-radius: 0 0 20px 20px;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            margin-bottom: 20px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .card-header {
            background-color: var(--secondary-color);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: 600;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .song-item {
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s;
        }
        
        .song-item:hover {
            background-color: rgba(52, 152, 219, 0.05);
        }
        
        .form-control {
            text-transform: uppercase;
        }
        
        .form-select {
            text-transform: uppercase;
        }
        
        textarea.form-control {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            line-height: 1.4;
        }
        
        .song-lyrics {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            line-height: 1.6;
            white-space: pre-wrap;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            cursor: text;
        }
        
        .search-info {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .action-buttons .btn {
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #dee2e6;
        }
        
        footer {
            background-color: var(--secondary-color);
            color: white;
            padding: 20px 0;
            margin-top: 40px;
        }
        
        .connection-status {
            background: #e7f3ff;
            border: 1px solid var(--primary-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .status-online {
            color: #28a745;
            font-weight: 600;
        }
        
        .status-offline {
            color: #dc3545;
            font-weight: 600;
        }
        
        .loading-spinner {
            text-align: center;
            padding: 20px;
        }
        
        .copy-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1050;
            display: none;
        }
        
        .lyrics-container {
            position: relative;
        }
        
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .copy-btn:hover {
            background: #f8f9fa;
            border-color: var(--primary-color);
        }
        
        @media (max-width: 768px) {
            .hero-section {
                padding: 40px 0;
            }
            
            .action-buttons .btn {
                margin-bottom: 5px;
            }
            
            body {
                font-size: 0.9rem;
            }
            
            .copy-btn {
                position: relative;
                top: 0;
                right: 0;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-church me-2"></i>LAGU MISA GEREJA
            </a>
            
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container text-center">
            <h1 class="display-4 fw-bold">LAGU MISA GEREJA</h1>
            <p class="lead">Kuasi Paroki St. Petrus Kanisius Lanud Supadio</p>
            <button class="btn btn-light btn-lg mt-3" data-bs-toggle="modal" data-bs-target="#tambah-lagu">
                <i class="fas fa-plus me-2"></i>TAMBAH LAGU BARU
            </button>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container">
        <!-- Connection Status -->
        <div class="connection-status">
            <i class="fas fa-database me-2"></i>
            <strong>STATUS DATABASE:</strong> 
            <span id="connectionStatus" class="status-online">MENGHUBUNGKAN...</span>
            <button class="btn btn-sm btn-outline-primary ms-3" onclick="refreshData()">
                <i class="fas fa-sync-alt me-1"></i>REFRESH
            </button>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-music me-2"></i>DAFTAR LAGU MISA</span>
                        <div class="input-group w-auto">
                            <input type="text" class="form-control" placeholder="CARI LAGU..." id="searchInput">
                            <button class="btn btn-outline-light" type="button" onclick="clearSearch()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                                               
                        <!-- Loading Spinner -->
                        <div id="loadingSpinner" class="loading-spinner" style="display: none;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">MEMUAT DATA...</span>
                            </div>
                            <p class="mt-2">SEDANG MEMUAT DATA DARI DATABASE...</p>
                        </div>
                        
                        <!-- Song List -->
                        <div id="songList"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Tambah/Edit Lagu -->
    <div class="modal fade" id="tambah-lagu" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">TAMBAH LAGU BARU</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="songForm">
                        <input type="hidden" id="songId">
                        <div class="mb-3">
                            <label for="songTitle" class="form-label">JUDUL LAGU <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="songTitle" required oninput="this.value = this.value.toUpperCase()">
                        </div>
                        <div class="mb-3">
                            <label for="songNumber" class="form-label">NOMOR LAGU</label>
                            <input type="text" class="form-control" id="songNumber" 
                                   placeholder="CONTOH: MB 456, PS 98" 
                                   oninput="this.value = this.value.toUpperCase()">
                            <div class="form-text">
                                BISA BERUPA ANGKA (1, 2, 3), TEKS (A, B, C), ATAU KOMBINASI (MB 456, PS 98)
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="songCategory" class="form-label">KATEGORI <span class="text-danger">*</span></label>
                            <select class="form-select" id="songCategory" required>
                                <option value="">PILIH KATEGORI</option>
                                <option value="PEMBUKAAN">PEMBUKAAN</option>
                                <option value="TUHAN KASIHANILAH">TUHAN KASIHANILAH</option>
                                <option value="KEMULIAAN">KEMULIAAN</option>
                                <option value="PERSIAPAN PERSEMBAHAN">PERSIAPAN PERSEMBAHAN</option>
                                <option value="BAPA KAMI">BAPA KAMI</option>
                                <option value="KUDUS">KUDUS</option>
                                <option value="ANAK DOMBA ALLAH">ANAK DOMBA ALLAH</option>
                                <option value="KOMUNI">KOMUNI</option>
                                <option value="PENUTUP">PENUTUP</option>
                                <option value="LAINNYA">LAINNYA</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="songLyrics" class="form-label">TEKS LAGU <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="songLyrics" rows="10" required oninput="this.value = this.value.toUpperCase()"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">BATAL</button>
                    <button type="button" class="btn btn-primary" id="saveSongBtn">
                        <i class="fas fa-cloud-upload-alt me-2"></i>SIMPAN KE DATABASE
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Lihat Lagu -->
    <div class="modal fade" id="viewSongModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewSongTitle">JUDUL LAGU</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <span class="badge bg-primary category-badge" id="viewSongCategory">KATEGORI</span>
                        <span class="badge bg-secondary ms-2 category-badge" id="viewSongNumber">NOMOR</span>
                    </div>
                    <div class="card lyrics-container">
                        <div class="card-body position-relative">
                            <button class="btn btn-sm btn-outline-primary copy-btn" onclick="copyLyrics()">
                                <i class="fas fa-copy me-1"></i>SALIN TEKS
                            </button>
                            <pre id="viewSongLyrics" class="song-lyrics"></pre>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">TUTUP</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Copy Notification -->
    <div class="copy-notification" id="copyNotification">
        <i class="fas fa-check-circle me-2"></i>TEKS BERHASIL DISALIN!
    </div>

    <!-- Footer -->
    <footer class="text-center mt-5">
        <div class="container">
            <p>&copy; 2025 - LAGU MISA GEREJA</p>
            <p class="mb-0">
                <i class="fas fa-church me-2"></i>Kuasi Paroki St. Petrus Kanisius Lanud Supadio
            </p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // =============================================
        // KONFIGURASI FIREBASE - GANTI DENGAN DATA ANDA!
        // =============================================
        
        // ðŸ”§ CARA DAPATKAN KONFIGURASI:
        // 1. Buka https://console.firebase.google.com
        // 2. Pilih project Anda
        // 3. Klik âš™ï¸ â†’ Project settings
        // 4. Scroll ke "Your apps" â†’ Klik "Web"
        // 5. Copy config object dan paste di bawah
        
        const firebaseConfig = {
  apiKey: "AIzaSyDrBUEDBL_8Vg3Xma5IM9ofjRksENedwh4",
  authDomain: "lagu-misa-gereja.firebaseapp.com",
  projectId: "lagu-misa-gereja",
  storageBucket: "lagu-misa-gereja.firebasestorage.app",
  messagingSenderId: "475970284457",
  appId: "1:475970284457:web:f18bfa4d5628bbb2ed32b8"
};


        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // =============================================
        // VARIABEL GLOBAL
        // =============================================
        let songs = [];
        let currentSongs = [];

        // =============================================
        // ELEMEN DOM
        // =============================================
        const songList = document.getElementById('songList');
        const songForm = document.getElementById('songForm');
        const saveSongBtn = document.getElementById('saveSongBtn');
        const searchInput = document.getElementById('searchInput');
        const copyNotification = document.getElementById('copyNotification');
        const connectionStatus = document.getElementById('connectionStatus');
        const loadingSpinner = document.getElementById('loadingSpinner');

        // Modal elements
        const tambahLaguModal = new bootstrap.Modal(document.getElementById('tambah-lagu'));
        const viewSongModal = new bootstrap.Modal(document.getElementById('viewSongModal'));

        // =============================================
        // FUNGSI UTAMA
        // =============================================
        
        // Fungsi untuk mengubah teks menjadi huruf kapital
        function toUpperCase(text) {
            return text ? text.toUpperCase() : '';
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            showLoading();
            initializeFirebase();
            setupEventListeners();
        });

        // Setup Firebase dan load data
        async function initializeFirebase() {
            try {
                // Test connection
                await db.collection('songs').limit(1).get();
                connectionStatus.textContent = "TERHUBUNG KE DATABASE ONLINE";
                connectionStatus.className = "status-online";
                await loadSongsFromFirebase();
            } catch (error) {
                console.error("Error connecting to Firebase:", error);
                connectionStatus.textContent = "GAGAL TERHUBUNG - DATA LOKAL";
                connectionStatus.className = "status-offline";
                loadFromLocalStorage();
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            saveSongBtn.addEventListener('click', saveSong);
            searchInput.addEventListener('input', filterSongs);
        }

        // Load songs from Firebase
        async function loadSongsFromFirebase() {
            try {
                const snapshot = await db.collection('songs').orderBy('createdAt', 'desc').get();
                songs = [];
                snapshot.forEach(doc => {
                    songs.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                currentSongs = [...songs];
                renderSongList();
                hideLoading();
                
                // Simpan ke localStorage sebagai backup
                localStorage.setItem('churchSongsBackup', JSON.stringify(songs));
                
            } catch (error) {
                console.error("Error loading songs:", error);
                loadFromLocalStorage();
            }
        }

        // Load from localStorage sebagai fallback
        function loadFromLocalStorage() {
            const backup = localStorage.getItem('churchSongsBackup');
            if (backup) {
                songs = JSON.parse(backup);
                currentSongs = [...songs];
                renderSongList();
            } else {
                showEmptyState();
            }
            hideLoading();
        }

        // Save song to Firebase
        async function saveSong() {
            const songId = document.getElementById('songId').value;
            const title = toUpperCase(document.getElementById('songTitle').value);
            const number = toUpperCase(document.getElementById('songNumber').value);
            const category = toUpperCase(document.getElementById('songCategory').value);
            const lyrics = toUpperCase(document.getElementById('songLyrics').value);

            if (!title || !lyrics || !category) {
                alert('JUDUL, KATEGORI, DAN TEKS LAGU HARUS DIISI!');
                return;
            }

            const songData = {
                title,
                number,
                category,
                lyrics,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                if (songId) {
                    // Update existing song
                    await db.collection('songs').doc(songId).update(songData);
                } else {
                    // Add new song
                    songData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('songs').add(songData);
                }

                // Refresh data
                await loadSongsFromFirebase();
                
                // Close modal and reset form
                bootstrap.Modal.getInstance(document.getElementById('tambah-lagu')).hide();
                document.getElementById('songForm').reset();
                document.getElementById('songId').value = '';

            } catch (error) {
                console.error("Error saving song:", error);
                alert('GAGAL MENYIMPAN KE DATABASE. COBA LAGI.');
            }
        }

        // Delete song from Firebase
        async function deleteSong(id) {
            if (confirm('APAKAH ANDA YAKIN INGIN MENGHAPUS LAGU INI?')) {
                try {
                    await db.collection('songs').doc(id).delete();
                    await loadSongsFromFirebase();
                } catch (error) {
                    console.error("Error deleting song:", error);
                    alert('GAGAL MENGHAPUS LAGU. COBA LAGI.');
                }
            }
        }

        // Refresh data
        async function refreshData() {
            showLoading();
            await loadSongsFromFirebase();
        }

        // =============================================
        // FUNGSI BANTUAN
        // =============================================
        
        function showLoading() {
            loadingSpinner.style.display = 'block';
            songList.style.display = 'none';
        }

        function hideLoading() {
            loadingSpinner.style.display = 'none';
            songList.style.display = 'block';
        }

        // Render daftar lagu
        function renderSongList() {
            const songsToRender = currentSongs;
            
            if (songsToRender.length === 0) {
                songList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-music"></i>
                        <h4>BELUM ADA LAGU</h4>
                        <p>MULAI DENGAN MENAMBAHKAN LAGU PERTAMA ANDA</p>
                        <button class="btn btn-primary mt-2" data-bs-toggle="modal" data-bs-target="#tambah-lagu">
                            <i class="fas fa-plus me-2"></i>TAMBAH LAGU
                        </button>
                    </div>
                `;
                return;
            }
            
            songList.innerHTML = songsToRender.map((song, index) => `
                <div class="card song-item mb-3">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <h5 class="card-title song-title">${toUpperCase(song.title)}</h5>
                                <div class="mb-2">
                                    <span class="badge bg-primary category-badge">${toUpperCase(song.category)}</span>
                                    <span class="badge bg-secondary ms-1 category-badge">${song.number ? 'NO. ' + toUpperCase(song.number) : 'TANPA NOMOR'}</span>
                                </div>
                                <small class="text-muted">Ditambahkan: ${new Date(song.createdAt?.toDate?.() || song.createdAt).toLocaleDateString('id-ID')}</small>
                            </div>
                            <div class="col-md-4 action-buttons">
                                <button class="btn btn-sm btn-outline-primary" onclick="viewSong('${song.id}')">
                                    <i class="fas fa-eye me-1"></i>LIHAT
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="editSong('${song.id}')">
                                    <i class="fas fa-edit me-1"></i>EDIT
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteSong('${song.id}')">
                                    <i class="fas fa-trash me-1"></i>HAPUS
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Filter lagu berdasarkan pencarian
        function filterSongs() {
            const searchTerm = searchInput.value.toLowerCase();
            
            if (!searchTerm) {
                currentSongs = [...songs];
                renderSongList();
                return;
            }
            
            currentSongs = songs.filter(song => {
                const titleMatch = song.title.toLowerCase().includes(searchTerm);
                const numberMatch = song.number ? song.number.toLowerCase().includes(searchTerm) : false;
                const categoryMatch = song.category.toLowerCase().includes(searchTerm);
                const lyricsMatch = song.lyrics.toLowerCase().includes(searchTerm);
                
                return titleMatch || numberMatch || categoryMatch || lyricsMatch;
            });
            
            renderSongList();
        }

        // Clear search
        function clearSearch() {
            searchInput.value = '';
            currentSongs = [...songs];
            renderSongList();
        }

        // Lihat detail lagu
        async function viewSong(id) {
            const song = songs.find(s => s.id === id);
            if (song) {
                document.getElementById('viewSongTitle').textContent = toUpperCase(song.title);
                document.getElementById('viewSongCategory').textContent = toUpperCase(song.category);
                document.getElementById('viewSongNumber').textContent = song.number ? `NO. ${toUpperCase(song.number)}` : 'TANPA NOMOR';
                document.getElementById('viewSongLyrics').textContent = toUpperCase(song.lyrics);
                viewSongModal.show();
            }
        }

        // Edit lagu
        async function editSong(id) {
            const song = songs.find(s => s.id === id);
            if (song) {
                document.getElementById('modalTitle').textContent = 'EDIT LAGU';
                document.getElementById('songId').value = id;
                document.getElementById('songTitle').value = toUpperCase(song.title);
                document.getElementById('songNumber').value = toUpperCase(song.number);
                document.getElementById('songCategory').value = toUpperCase(song.category);
                document.getElementById('songLyrics').value = toUpperCase(song.lyrics);
                tambahLaguModal.show();
            }
        }

        // Copy lyrics to clipboard
        function copyLyrics() {
            const lyricsElement = document.getElementById('viewSongLyrics');
            const lyricsText = lyricsElement.textContent;
            
            const textarea = document.createElement('textarea');
            textarea.value = lyricsText;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            
            textarea.select();
            textarea.setSelectionRange(0, 99999);
            
            try {
                document.execCommand('copy');
                showCopyNotification();
            } catch (err) {
                console.error('Copy failed: ', err);
            }
            
            document.body.removeChild(textarea);
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(lyricsText).catch(err => {
                    console.error('Clipboard API failed: ', err);
                });
            }
        }

        // Show copy notification
        function showCopyNotification() {
            copyNotification.style.display = 'block';
            setTimeout(() => {
                copyNotification.style.display = 'none';
            }, 2000);
        }

        // Reset form ketika modal ditutup
        document.getElementById('tambah-lagu').addEventListener('hidden.bs.modal', function() {
            document.getElementById('modalTitle').textContent = 'TAMBAH LAGU BARU';
            document.getElementById('songId').value = '';
            songForm.reset();
            document.getElementById('songCategory').value = '';
        });

        // Enter key untuk search
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                filterSongs();
            }
        });

        function showEmptyState() {
            songList.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-database"></i>
                    <h4>DATABASE KOSONG</h4>
                    <p>BELUM ADA LAGU YANG DISIMPAN DI DATABASE</p>
                    <button class="btn btn-primary mt-2" data-bs-toggle="modal" data-bs-target="#tambah-lagu">
                        <i class="fas fa-plus me-2"></i>TAMBAH LAGU PERTAMA
                    </button>
                </div>
            `;
        }
    </script>
</body>
</html>